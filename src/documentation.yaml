openapi: "3.1.0"
info:
  title: "NodeJs Rest API architecture"
  description: "This is the documentation for the REST API architecture"
  version: "1.0.0"
  contact:
    email: "marvinramos@ravn.co"
    name: "Marvin Ramos"
tags:
  - name: auth
  - name: users
  - name: favorites
  - name: carts
  - name: products
  - name: orders
servers:
  - url: "https://localhost:3000/api/v1"
paths:
  /auth/signin:
    post:
      tags:
        - auth
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/SignInRequest"
        required: true
      responses:
        '200':
          description: Successfully login
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SignInResponse"
        400:
          description: Missing some fields
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/LoginBadRequestResponse"
        500:
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ServerErrorResponse"
  /auth/signout:
    post:
      tags:
        - "auth"
      security:
        - bearerAuth: [ ]
      responses:
        204:
          description: You have been signed out
        401:
          description: Unauthorized access.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UnauthorizedResponse"
        500:
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ServerErrorResponse"
  /users/signup:
    post:
      tags:
        - users
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/SingUpRequest"
      responses:
        201:
          description: New user was recorded.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SingUpResponse"
        400:
          description: Missing some fields
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SignUpBadRequestResponse"
        500:
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ServerErrorResponse"
  /users/forgot-password:
    put:
      summary: Request a password reset email
      tags:
        - users
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ForgotPasswordRequest"
      responses:
        202:
          description: Password reset email sent if the email exists.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ForgotPasswordResponse"
        400:
          description: Invalid email or bad request.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ForgotPasswordBadRequestResponse"
        500:
          description: Internal server error.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ServerErrorResponse"

  /users/reset-password:
    put:
      summary: Reset password using a token
      tags:
        - users
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ResetPasswordRequest"
      responses:
        204:
          description: Password successfully reset.
        400:
          description: Invalid token or bad request.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ResetPasswordBadRequestResponse"
        500:
          description: Internal server error.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ServerErrorResponse"

  /favorites:
    post:
      summary: Add product to my favorites
      tags:
        - favorites
      security:
        - bearerAuth: [ ]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/FavoritesRequest"
      responses:
        201:
          description: Product added to user's favorites.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/FavoritesResponse"
        400:
          description: Invalid id or bad request.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/FavoritesBadRequestResponse"
        401:
          description: Unauthorized access.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UnauthorizedResponse"
        500:
          description: Internal server error.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ServerErrorResponse"
    get:
      summary: Get all user's favorites products
      tags:
        - favorites
      security:
        - bearerAuth: [ ]
      responses:
        200:
          description: Show all user's favorites products
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/GetFavoritesResponse"
        401:
          description: Unauthorized access.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UnauthorizedResponse"
        500:
          description: Internal server error.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ServerErrorResponse"
  /favorites/{favorite_id}:
    delete:
      summary: Remove a product from favorites
      tags:
        - favorites
      security:
        - bearerAuth: [ ]
      parameters:
        - name: favorite_id
          in: path
          description: The unique identifier of the favorite item to be removed.
          required: true
          schema:
            type: string
            format: uuid
      responses:
        204:
          description: Successfully removed the favorite product.
        400:
          description: Invalid id or bad request.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/DeleteFavoritesBadRequestResponse"
        401:
          description: Unauthorized access.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UnauthorizedResponse"
        500:
          description: Internal server error.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ServerErrorResponse"

  /carts:
    post:
      summary: Add a new cart record
      tags:
        - carts
      security:
        - bearerAuth: [ ]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CartRequest"
      responses:
        201:
          description: The cart record was successfully added.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CartResponse"
        400:
          description: Invalid ID or bad request.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CartBadRequestResponse"
        401:
          description: Unauthorized access.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UnauthorizedResponse"
        500:
          description: Internal server error.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ServerErrorResponse"
    get:
      summary: Show all user's carts
      tags:
        - carts
      security:
        - bearerAuth: [ ]
      responses:
        200:
          description: Show your current carts list.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/GetAllCartResponse"

        401:
          description: Unauthorized access.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UnauthorizedResponse"
        500:
          description: Internal server error.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ServerErrorResponse"

  /carts/{cart_id}:
    patch:
      summary: Allows user to increment or decrement the quantity of a product in the cart
      tags:
        - carts
      security:
        - bearerAuth: [ ]
      parameters:
        - name: cart_id
          in: path
          description: The unique identifier of the cart item to be edited.
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/PatchCartRequest"
      responses:
        200:
          description: Cart item updated successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CartResponse"
        401:
          description: Unauthorized access
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UnauthorizedResponse"
        500:
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ServerErrorResponse"

    delete:
      summary: Removes a product from the cart
      tags:
        - carts
      security:
        - bearerAuth: [ ]
      parameters:
        - name: cart_id
          in: path
          description: The unique identifier of the cart item to be deleted.
          required: true
          schema:
            type: string
            format: uuid
      responses:
        204:
          description: Cart item deleted successfully
        401:
          description: Unauthorized access
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UnauthorizedResponse"
        500:
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ServerErrorResponse"


  /products:
    post:
      summary: Add a new product record
      tags:
        - products
      description: Allows `admin` roles to create a new product record.
      security:
        - bearerAuth: [ ]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ProductRequest"
      responses:
        201:
        401:
          description: Unauthorized access
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UnauthorizedResponse"
        403:
          description: Permission denied
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PermissionResponse"
        500:
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ServerErrorResponse"
    get:
      summary: Show all products by pagination
      tags:
        - products
      description: Allows `admin` roles to create a new product record.
      security:
        - bearerAuth: [ ]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/FavoritesRequest"
      responses:
        401:
          description: Unauthorized access
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UnauthorizedResponse"
        403:
          description: Permission denied
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PermissionResponse"
        500:
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ServerErrorResponse"

  /products/{product_id}:
    get:
      summary: Show product detail
      tags:
        - products
      description: Allows `admin` roles to read a product detail.
      security:
        - bearerAuth: [ ]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/FavoritesRequest"
      responses:
        401:
          description: Unauthorized access
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UnauthorizedResponse"
        403:
          description: Permission denied
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PermissionResponse"
        500:
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ServerErrorResponse"

    put:
      summary: Edit a product record
      tags:
        - products
      description: Allows `admin` roles to edit a product record.
      security:
        - bearerAuth: [ ]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/FavoritesRequest"
      responses:
        401:
          description: Unauthorized access
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UnauthorizedResponse"
        403:
          description: Permission denied
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PermissionResponse"
        500:
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ServerErrorResponse"

    patch:
      summary: Edit a product record field
      tags:
        - products
      description: Allows `admin` roles to change product visibility and image url.
      security:
        - bearerAuth: [ ]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/FavoritesRequest"
      responses:
        401:
          description: Unauthorized access
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UnauthorizedResponse"
        403:
          description: Permission denied
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PermissionResponse"
        500:
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ServerErrorResponse"

    delete:
      summary: Remove a product record
      tags:
        - products
      description: Allows `admin` roles to remove a product record.
      security:
        - bearerAuth: [ ]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/FavoritesRequest"
      responses:
        401:
          description: Unauthorized access
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UnauthorizedResponse"
        403:
          description: Permission denied
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PermissionResponse"
        500:
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ServerErrorResponse"




components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  schemas:
    SignInRequest:
      type: object
      properties:
        email:
          type: string
          format: email
          example: example@mail.com
        password:
          type: string
          format: password
          example: Myp@ssword123
      required:
        - email
        - password
    SignInResponse:
      type: object
      properties:
        status:
          type: string
          example: success
        message:
          type: string
          example: You've been logged successfully
        data:
          type: object
          properties:
            bearer_token:
              type: string
              example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c
    LoginBadRequestResponse:
      type: object
      properties:
        status:
          type: string
          example: failure
        message:
          type: string
          example: Invalid payload
        data:
          type: object
          properties:
            email:
              type: string
              example: This field is required!
    SingUpRequest:
      type: object
      properties:
        first_name:
          type: string
          example: John
        last_name:
          type: string
          example: Doe
        email:
          type: string
          format: email
          example: johndoe@example.com
        address:
          type: string
          example: 123 Av. F
        password:
          type: string
          format: password
          example: P@ssw0rd!
      required:
        - first_name
        - last_name
        - email
        - password
    ForgotPasswordRequest:
      type: object
      properties:
        email:
          type: string
          format: email
          description: The email address associated with the account.
      required:
        - email

    ForgotPasswordResponse:
      type: object
      properties:
        status:
          type: string
          example: success
        message:
          type: string
          example: An mail was sent to this email
        data:
          type: object
          example: { }

    ForgotPasswordBadRequestResponse:
      type: object
      properties:
        status:
          type: string
          example: failure
        message:
          type: string
          example: Invalid payload
        data:
          type: object
          properties:
            email:
              type: string
              example: This field is required!
    ResetPasswordRequest:
      type: object
      properties:
        token:
          type: string
          format: uuid
          example: 6264efef-d9ca-475b-91f5-5770d3b02fac
          description: The reset token sent via email.
        new_password:
          type: string
          example: P@ssw0rd!
          format: password
          description: The new password for the account.
      required:
        - token
        - new_password
    ResetPasswordBadRequestResponse:
      type: object
      properties:
        status:
          type: string
          example: failure
        message:
          type: string
          example: Invalid payload
        data:
          type: object
          properties:
            new_password:
              type: string
              example: This field is required!

    SingUpResponse:
      type: object
      properties:
        status:
          type: string
          example: success
        message:
          type: string
          example: You've been singed up successfully
        data:
          type: object
    SignUpBadRequestResponse:
      type: object
      properties:
        status:
          type: string
          example: failure
        message:
          type: string
          example: Invalid payload
        data:
          type: object
          properties:
            first_name:
              type: string
              example: This field is required!

    FavoritesRequest:
      type: object
      properties:
        product_id:
          type: uuid
          example: 6264efef-d9ca-475b-91f5-5770d3b02fac
          description: User's favorite product id.
      required:
        - product_id
    FavoritesResponse:
      type: object
      properties:
        status:
          type: string
          example: success
        message:
          type: string
          example: A product was added to your favorites
        data:
          type: object
          properties:
            id:
              type: uuid
              example: 6264efef-d9ca-475b-91f5-5770d3b02fac
            created_at:
              type: string
              example: 2024-12-05T14:00:00Z
    GetFavoritesResponse:
      type: object
      properties:
        status:
          type: string
          example: success
        message:
          type: string
          example: Here are your favorites
        data:
          type: array
          items:
            $ref: "#/components/schemas/GetFavoritesData"

    GetFavoritesData:
      type: object
      properties:
        id:
          type: string
          format: uuid
          example: 97c978f0-3975-41a7-b9af-7fa0abfc5081
        product_id:
          type: string
          format: uuid
          example: a09c037a-cead-42c8-8ac0-dbdc158b497f
        product_name:
          type: string
          example: Samsung Galaxy A55
        unit_price:
          type: decimal
          example: 350.00
        currency:
          type: string
          example: USD
        image_url:
          type: string
          format: uri
          example: https://storage-domain.com/image.png
        uri:
          type: string
          format: uri
          example: /products/a09c037a-cead-42c8-8ac0-dbdc158b497f

    FavoritesBadRequestResponse:
      type: object
      properties:
        status:
          type: string
          example: failure
        message:
          type: string
          example: Invalid payload
        data:
          type: object
          properties:
            product_id:
              type: string
              example: This field is required!
    DeleteFavoritesBadRequestResponse:
      type: object
      properties:
        status:
          type: string
          example: failure
        message:
          type: string
          example: Invalid payload
        data:
          type: object
          properties:
            favorite_id:
              type: string
              example: This field is required!

    CartRequest:
      type: object
      properties:
        product_id:
          type: string
          format: uuid
          example: 6264efef-d9ca-475b-91f5-5770d3b02fac
          description: List of product IDs to be added to the cart.
        quantity:
          type: integer
          example: 2
      required:
        - product_id

    PatchCartRequest:
      type: object
      properties:
        op:
          type: string
          example: replace
        path:
          type: string
          example: /carts
        value:
          type: integer
          example: 7


    CartResponse:
      type: object
      description: Response returned when the user is unauthorized to access the requested resource.
      properties:
        status:
          type: string
          description: Indicates the status of the response.
          example: success
        message:
          type: string
          description: A message providing more details about the unauthorized access.
          example: Cart added successfully.
        data:
          type: object
          description: Contains additional details about .
          $ref: "#/components/schemas/CartItem"
    CartBadRequestResponse:
      type: object
      properties:
        status:
          type: string
          example: failure
        message:
          type: string
          example: Invalid payload
        data:
          type: object
          properties:
            product_id:
              type: string
              example: This field is required!

    GetAllCartResponse:
      type: object
      description: Response returned when the user is unauthorized to access the requested resource.
      properties:
        status:
          type: string
          description: Indicates the status of the response.
          example: success
        message:
          type: string
          description: A message providing more details about the unauthorized access.
          example: Cart added successfully.
        data:
          type: array
          description: Response show all the user's carts
          items:
            $ref: "#/components/schemas/AllCartItem"


    GetCartResponse:
      type: object
      description: Response returned when the user is unauthorized to access the requested resource.
      properties:
        status:
          type: string
          description: Indicates the status of the response.
          example: success
        message:
          type: string
          description: A message providing more details about the unauthorized access.
          example: Cart added successfully.
        data:
          type: object
          description: Contains additional details about .
          $ref: "#/components/schemas/CartItem"

    CartItem:
      type: object
      properties:
        id:
          type: string
          format: uuid
          example: 97c978f0-3975-41a7-b9af-7fa0abfc5081
        created_at:
          type: string
          example: 2024-12-05T14:10:00Z

    AllCartItem:
      type: object
      properties:
        id:
          type: string
          format: uuid
          example: 97c978f0-3975-41a7-b9af-7fa0abfc5081
        product_id:
          type: string
          format: uuid
          example: bb790a0e-a8d1-4c6e-8301-c2bbc8168431
        product_name:
          type: string
          format: uuid
          example: AJAZZ Keyboard
        unit_price:
          type: decimal
          example: 20.66
        currency:
          type: string
          example: USD
        uri:
          type: string
          format: uri
          example: /products/bb790a0e-a8d1-4c6e-8301-c2bbc8168431

    ProductRequest:
      type: object
      properties:
        product_name:
          type: string
          example: Control xbox series x s one
          description: product's name
        description:
          type: string
          example: Conéctate a las consolas Xbox con la tecnología inalámbrica de Xbox.
            Conéctate de forma inalámbrica a PC Windows 10/11, tabletas, iOS y Android mediante Bluetooth.
        stock:
          type: integer
          example: 39
          description: This field represents the existence of the product in the inventory.
        is_available:
          type: boolean
          example: true
          description: This field represent if product could be visible for customers
        image_url:
          type: string
          example: http://storage.com/bb790a0e-a8d1-4c6e-8301-c2bbc8168431.png
          description: This field represent product image
        unit_price:
          type: decimal
          example: 59.99
      required:
        - product_name
        - description
        - stock
        - image_url
        - unit_price

    UnauthorizedResponse:
      type: object
      description: Response returned when the user is unauthorized to access the requested resource.
      properties:
        status:
          type: string
          description: Indicates the status of the response.
          example: failure
        message:
          type: string
          description: A message providing more details about the unauthorized access.
          example: Unauthorized access.
        data:
          type: object
          description: Contains additional details about the error.
          properties:
            error:
              type: string
              description: Specific error details.
              example: Invalid token or token expired.

    PermissionResponse:
      type: object
      description: Response returned when the user has not permissions to execute the requested action.
      properties:
        status:
          type: string
          description: Indicates the status of the response.
          example: failure
        message:
          type: string
          description: A message providing more details about the permission access.
          example: Not permission access.
        data:
          type: object
          description: Contains additional details about the error.
          properties:
            error:
              type: string
              description: Specific error details.
              example: Invalid user permissions.

    ServerErrorResponse:
      type: object
      description: Response returned when the server run into an error.
      properties:
        status:
          type: string
          description: Indicates the status of the response.
          example: failure
        message:
          type: string
          description: A message providing more details about server error.
          example: Internal server error.
        data:
          type: object
          description: Contains additional details about the error.
          properties:
            error:
              type: string
              description: Specific error details.
              example: Can't implement that action.
